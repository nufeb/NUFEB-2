%thesis.tex 
%Model LaTeX file for Ph.D. thesis at the 
%School of Mathematics, University of Edinburgh


\documentclass[11pt,a4paper,openright]{article}

%\usepackage{url,graphicx}

\usepackage{amsmath}
%\usepackage{natbib}
\usepackage{booktabs}
\usepackage{fancyvrb}
\usepackage{graphicx}
\usepackage{hyperref}%backref,
%\usepackage[dvips]{color}
\graphicspath{{expt/}}
\usepackage{enumitem}
\usepackage{filecontents}


\usepackage{times}
\usepackage[varg]{txfonts}

%%% Macro definitions for Commonly used symbols
\newcommand{\etas}{\ensuremath{\eta_{\mathrm{s}}}}
%\documentclass[a4paper, 11pt, draft]{Thesis} 

\usepackage{etex}
\usepackage{fixltx2e}
\usepackage{color,soul}
\include{Macros/MacroFile} % This file adds the macros for adding figures
  
% Include any extra LaTeX packages required
\usepackage[square, authoryear, colon, sort&compress]{natbib}  % Use the "Natbib" style for the references in the Bibliography
%\usepackage{verbatim}  % Needed for the "comment" environment to make LaTeX comments
\usepackage{vector}  % Allows "\bvec{}" and "\buvec{}" for "blackboard" style bold vectors in maths
\usepackage{float}
\usepackage{ifpdf}

%%% Some Fonts
\usepackage{textcomp}
\usepackage{pifont}% http://ctan.org/pkg/pifont
\usepackage{needspace}
\usepackage[noabbrev]{cleveref} %For crossreferencing

\usepackage{etoolbox}
\usepackage{float}

%%% For Changing fonts
%\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{charter}
%\usepackage[expert]{mathdesign}

%%% Packages for tables
\usepackage[usenames,dvipsnames,table]{xcolor}
\usepackage{hyperref}
\definecolor{red}{RGB}{255,50,50}
\definecolor{light_orange}{RGB}{253,245,230}
\definecolor{gray}{RGB}{225,225,225}
\usepackage{colortbl}% Allows shading of table cells
% Define a simple command to use at the start of a table row to make it have a shaded background
%\newcommand{\gray}{\rowcolor[gray]{.9}}

% % % Packages for TikZ setup for diagrams
%\usepackage[mode=buildnew]{standalone}
%%\standaloneconfig{mode=buildnew}
%\usepackage{tikz,pgfplots}
%\pgfplotsset{compat=newest}
%\usetikzlibrary{shapes,shapes.multipart,shapes.misc,shapes.geometric,arrows,shapes.symbols,shadows,shadows.blur}
%\usepackage{arydshln}
\usepackage{bm}
%\usepackage{tocbibind} 
%\renewcommand{\refname}{References}
%\renewcommand{\bibname}{References}

%:-------------------------- packages for fancy things -----------------------

%%% A (page...) to backref
\makeatletter
\patchcmd{\BR@backref}{\newblock}{\newblock(p.~}{}{}
\patchcmd{\BR@backref}{\par}{)\par}{}{}
\makeatother

%Make equation number label bold
\makeatletter
\let\mytagform@=\tagform@
\def\tagform@#1{\maketag@@@{\bfseries(\ignorespaces#1\unskip\@@italiccorr)}\hspace{3mm}}
\renewcommand{\eqref}[1]{\textup{\mytagform@{\ref{#1}}}}
\makeatother

%Fancy Chapter Heading style
%\usepackage[T1]{fontenc}
%\usepackage{titlesec, blindtext, color}
%\definecolor{gray75}{gray}{0.75}
%\newcommand{\hsp}{\hspace{20pt}}
%\titleformat{\chapter}[hang]{\Huge\bfseries}{\thechapter\hsp\textcolor{gray75}{|}\hsp}{0pt}{\Huge\bfseries}


%:-------------------------- packages for comments and notes -----------------------

\usepackage[colorinlistoftodos,shadow]{todonotes}
%%% Numbered ToDo Notes
\newcounter{todocounter}
\newcommand{\todonum}[2][]
{\stepcounter{todocounter}\todo[#1,size=\tiny]{\thetodocounter: #2}}

\newcommand{\hlfix}[2]{\texthl{#1}\todo{#2}}

\newcommand{\smalltodo}[2][]
{\todo[caption={#2}, author=PG, size=\footnotesize, #1]
{\begin{spacing}{0.5}#2\end{spacing}}}

%%% Word Style TODO Notes
\newcounter{mycomment}
\newcommand{\mycomment}[2][]{%
% initials of the author (optional) + note in the margin
\refstepcounter{mycomment}%
{%
\setstretch{0.7}% spacing
\todo[color={red!100!green!33},size=\tiny]{%
\textbf{Comment [\uppercase{#1}\themycomment]:}~#2}%
}}

%\includeonly{Chapters/C4} 

%% ================================
% PDF output options
\pdfminorversion=5
\pdfcompresslevel=9
\pdfobjcompresslevel=2
%% ================================

%% ----------------------------------------------------------------
%% End of Preamble
%% ----------------------------------------------------------------




\begin{document}
%
\title{NUFEB User Manual \\ Version 2.0}
%\date{14 Azad 1391}

\maketitle



\pagenumbering{roman}
\newpage
\tableofcontents


\cleardoublepage
\setcounter{page}{1}
\pagenumbering{arabic}


\section{Introduction}

This document provides information on how to download, compile, and start using NUFEB.

NUFEB is an open source tool for Individual Based model (IBm) simulation. The tool is implemented as a user package within LAMMPS - a molecular dynamics simulator offering basic functionalities for Discrete Element Method (DEM) simulations. NUFEB aims to improve those capability with the goal to apply it to biological modelling.  

NUFEB is a freely-available open-source code, distributed under the terms of the GNU Public License.

NUFEB development has been funded by the EPSRC project An New Frontier in Design: The Simulation of Open Engineered Biological Systems (NUFEB).

\subsection{NUFEB features}
The list below highlights NUFEB features, with pointers to specific commands which give more details. \\

\noindent\textbf{Microbes and nutrients}\\
\noindent(\hyperref[atomstyle]{\tt atom\_style}, \hyperref[readdata]{\tt read\_data\_bio} commands) \\
\begin{itemize} [nosep]
\item spherical microbes 
\item microbial species 
\item gas and liquid nutrients \\
\end{itemize}  

\noindent\textbf{Biological features}\\
\noindent(\hyperref[fkineticsmonod]{\tt fix kinetics/growth/monod}, 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy}, 
\hyperref[divide]{\tt fix divide}, 
\hyperref[epsextract]{\tt fix eps\_extract}, 
\hyperref[death]{\tt fix death} commands)\\

\begin{itemize} [nosep]
\item monod-based growth
\item energy-based growth
\item cell division
\item EPS production
\item cell death \\
\end{itemize} 

\noindent\textbf{Chemical features} \\
\noindent(\hyperref[fkineticsph]{\tt fix kinetics/ph}, 
\hyperref[fkineticsthermo]{\tt fix kinetics/thermo} commands)\\
\begin{itemize} [nosep]
\item pH
\item gas-liquid transfer
\item thermodynamic \\
\end{itemize} 

\noindent\textbf{Physical features}\\
\noindent(\hyperref[fkineticsdiffusion]{\tt fix kinetics/diffusion}, 
\hyperref[epsadh]{\tt fix epsadh}, 
\hyperref[walladh]{\tt fix walladh}, 
\hyperref[shear]{\tt fix shear}, 
\href{http://lammps.sandia.gov/doc/pair_gran.html}{\tt pair\_style gran/hooke/history}, 
\href{http://lammps.sandia.gov/doc/fix_wall_gran.html}{\tt fix wall/gran}, 
\href{http://lammps.sandia.gov/doc/fix_viscous.html}{\tt fix viscous} commands)\\
\begin{itemize} [nosep]
\item nutrient mass balance
\item EPS adhesion
\item wall adhesion
\item shear force
\item contact force
\item viscous force \\
\end{itemize} 

\noindent\textbf{Output}\\
\noindent(\hyperref[dumpbio]{\tt dump bio}, \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style},      \hyperref[cntypes]{\tt compute ntypes},
     \hyperref[cbiomass]{\tt compute biomass},
     \hyperref[cdiameter]{\tt compute diameter} ,
     \hyperref[cdimension]{\tt compute dimension},
     \hyperref[cdiversity]{\tt compute diversity} ,
     \hyperref[caveheight]{\tt compute ave\_height},
     \hyperref[croughness]{\tt compute roughness},
     \hyperref[csegregation]{\tt compute segregation}  commands) \\
     
\begin{itemize} [nosep]
\item compute and text dump files of microbe-, species-, biofilm- and field-related properties \\
\end{itemize} 

\noindent\textbf{post-processing}\\
\begin{itemize} [nosep]
\item routines for post-processing are packaged with NUFEB\\
\end{itemize} 


\section{LAMMPS}
\subsection{Introduction to LAMMPS}
LAMMPS is a classical molecular dynamics code developed at Sandia labs and primarily built to solve the particle physics including wide range of inter-particle interactions and potentials. The code treats each particle as an individual discrete unit, much similar to the popular IB approach. Sandia Labs distributes LAMMPS under the terms of the GNU Public License (http://lammps.sandia.gov/). The current version of the code is written in C++ with an open architecture and provides an opportunity to couple with other open-source codes. LAMMPS can run efficiently in both serial and parallel versions depending upon the computational facilities available to the users.  The LAMMPS code is designed to modify and extend it with newer capabilities as desired by the user. While only 25\% of the 140K line code in LAMMPS forms the core of the solver, rest of the code is contributed by a large user database across the globe in order to extend its capabilities. An overview can of current LAMMPS capabilities can be found at \href{http://lammps.sandia.gov/features.html}{LAMMPS-feature}.

\subsection{LAMMPS working methodology}
LAMMPS solves the motion of every single particle by simply integrating Newton's equations of motion in response to sum of the forces (short or long range based on their interaction with neighbours). At a particular time instance, motion of each particle is collectively solved when subjected to initial or boundary conditions. In order to maintain computational tractability while calculating the interaction forces, LAMMPS maintains a neighbourhood list for each particle which gets updated every so often. These lists are optimized so that local densities and particle overlaps never becomes non-physical. For parallel simulations, LAMMPS spatially partition the domain into smaller sub-domains assigned to each processors. Interprocessor communications are maintained by storing ghost atom interactions with the sub-domain boundaries. LAMMPS development can be helped by two user manuals: User manual and developer manual. The following links will be helpful for the users to get started on LAMMPS:

\begin{enumerate}
\item User manual: \url{http://lammps.sandia.gov/doc/Manual.pdf}
\item Developers guide: \url{http://lammps.sandia.gov/doc/Developer.pdf}
\item Tutorials: \url{http://lammps.sandia.gov/tutorials.html}
\item Commands: \url{http://lammps.sandia.gov/doc/Section_commands.html}
\item Features: \url{http://lammps.sandia.gov/features.html}
\end{enumerate}

%A further overview on LAMMPS can be taken from: $http://lammps.sandia.gov/tutorials/italy14/italy_overview_Mar14.pdf$
In the present study, lammps5Nov16 version is developed and newer IB features and capabilities added, this version will be now on referred as NUFEB. 

\subsection{Operating systems}
In general, LAMMPS can be run on Windows, Linux, Mac OS using pre-built executables. NUFEB can be compiled with almost any Linux or Mac OS (instructions in the user manual). It is emphasized that present NUFEB version 2.0 has been rigorously tested on Ubuntu-14.10 and Centos-7. In near future, pre-built executables, binaries or RPMS will be provided to be used on any OS.

\subsection{Pre-compilation instructions}

Before compiling NUFEB, please make sure you are installed with the following package depending upon the operating system used:
\begin{itemize}
\item gcc/g++ (https://help.ubuntu.com/community/InstallingCompilers)
\end{itemize} 

\section{NUFEB Compilation Instructions}
This section covers instructions on compiling NUFEB and how to get started. 

\subsection{Downloading NUFEB}
There are several ways to get the NUFEB software.

\begin{enumerate}
\item You can download source tarball from \href{https://github.com/nufeb/NUFEB}{NUFEB Github repository}
\item If you have \href{https://git-scm.com/}{GIT} installed on your machine, you can use checkout and update commands to get the NUFEB files once and then stay current. To do this, use the clone command to create a local copy of the NUFEB repository with a command: 

\begin{verbatim}
  $ git clone https://github.com/nufeb/NUFEB.git
\end{verbatim}

Once the command completes, a new directory named "NUFEB" will be created on your machine which contains the latest NUFEB source code. 

After initial cloning, as bug fixes and new features are added to NUFEB, as listed on \href{https://github.com/nufeb/NUFEB/releases}{Github release page}, you can stay up-to-date by typing the following Git commands from within the "NUFEB" directory: 

\begin{verbatim}
  $ git checkout master
  $ git pull
\end{verbatim}

\item Pre-built Linux executables is available at \href{https://github.com/nufeb/NUFEB/releases}{Github release page}. This allows you to install NUFEB with a single step, and stay up-to-date with the current version of NUFEB.

\end{enumerate}



\subsection{Compiling NUFEB from source}
If you want to avoid building NUFEB yourself, read the preceeding section about options available for downloading and installing executables.

Once downloaded, the source code for NUFEB can be found in the 

\noindent{\tt NUFEB/src/} directory.  To compile this code, go to that directory:

\begin{verbatim}
  $ cd NUFEB/src/
\end{verbatim}

\noindent
and execute the following commands to compile code in the STUBS directory, and then go back to the previous level of the directory tree:

\begin{verbatim}
  $ cd STUBS/
  $ make
  $ cd ..
\end{verbatim}

\noindent
Now, install the NUFEB and granular packages with the following instruction in the \noindent{\tt NUFEB/src/} directory:

\begin{verbatim}
  $ make yes-USER-NUFEB
  $ make yes-GRANULAR
\end{verbatim}

\noindent
You should get the messages ``Installing package USER-NUFEB'' and ``Installing package GRANULAR'' with no errors.  Finally, execute the following command to compile the NUFEB executable:

\begin{verbatim}
  $ make serial
\end{verbatim}

\noindent
This process may take some time to complete.  When finished without errors, you should have an executable ``lmp\_serial'' in the {\tt NUFEB/src/} directory.

\subsection{Running an Input Script with NUFEB}

NUFEB provides several example cases in the {\tt NUFEB/examples/} directory. To run the examples, go to one of the subdirectories and execute ``lmp\_serial'' passing in the ``Inputscript.lammps'' file, for example:

\begin{verbatim}
  $ cd NUFEB/examples/biofilm-monod-low/
  $ ../../src/./lmp_serial < Inputscript.lammps
\end{verbatim}

\noindent
The output should look similar to this:

\begin{verbatim}
LAMMPS (5 Nov 2016)
Reading data file ...
  orthogonal box = (0 0 0) to (0.0001 4e-05 0.0001)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  44 atoms
  5 nutrients
40 atoms in group HET
1 atoms in group AOB
1 atoms in group NOB
1 atoms in group EPS
1 atoms in group DEAD
Neighbor list info ...
  3 neighbor list requests
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 5000, page size: 100000
  master list distance cutoff = 1.5e-06
  ghost atom cutoff = 1.5e-06
  binsize = 7.5e-07, bins = 134 54 134
Setting up Verlet run ...
  Unit style    : lj
  Current step  : 0
  Time step     : 10
Memory usage per processor = 13.5482 Mbytes
Step CPU Atoms biomass
       0        0            44      3.141593e-15
       200      21.248521    44      6.2983664e-15
       300      31.739556    84      9.3072192e-15
       .        .            .       .    
       .        .            .       .    
       .        .            .       .   

\end{verbatim}

\noindent
After running, there should be a ``output.lammps'' file in the same directory as output.

\subsection{Add the NUFEB Executable to Your Path (Optional)}

\noindent
To make your life easier, you can add the ``lmp\_serial'' executable to your path using the following command from within the {\tt NUFEB/src/} directory:

\begin{verbatim}
  $ export PATH=$PATH:$PWD
\end{verbatim}

\noindent
This addition, however, will only last for the current session.  To permanently add it to your path, add the previous line to your ``.bashrc'' file in your home directory replacing ``\$PWD'' with the path to your {\tt NUFEB/src/} directory.  Once ``lmp\_serial'' is on your path, it can simply be executed as follows replacing ``input.lammps'' with the input script you want to run:

\begin{verbatim}
  $ lmp_serial < Inputscript.lammps
\end{verbatim}

\subsection{Post-processing}

In order to post-process NUFEB output, you need to have the following software packages:

\begin{itemize}
\item POVray (http://www.povray.org/) 
\item MATLAB (http://uk.mathworks.com/products/matlab/)
\item ParaView (https://www.paraview.org/) 
\end{itemize}

\noindent
To visualize microbial particles, copy the ``output.lammps'' file to the \\
{\tt NUFEB/examples/.../visual/} directory, change to this directory and execute the ``run.sh'' script:

\begin{verbatim}
  $ cp output.lammps visual/
  $ cd visual/
  $ ./run.sh
\end{verbatim}

\noindent
This script will process the output file to generate a collection of images for each time point as well as a time-lapse video of the simulation in the {\tt 0\_images/} directory.

To visualize nutrient concentration, pH, energy or yield field, import the output data located in the {\tt examples/../Result/} directory to ParaView (more details coming soon).

\section{Input Script}

In order to execute NUFEB simulation, an input script (text file) is usually prepared with certain commands and parameters list. NUFEB executes by reading those commands and parameters, one line at a time. When the input script ends, NUFEB exits. Each command causes NUFEB to take some actions. It may set an internal variable, read in a file, or run a simulation.

This section explains the commands used for IBm simulation. We will focus on the newer capabilities and commands in NUFEB package. For the pre-existing LAMMPS commands, features and documentation, please
refer to the \href{http://lammps.sandia.gov/doc/Manual.pdf}{LAMMPS user manual} for more details.


\subsection{Input script structure}

This section describes the structure of a typical NUFEB input script. 
We will take the scripts in  the {\tt NUFEB/examples/} directory as examples for the explanation. 

A NUFEB input script typically has 4 parts:\\

\begin{itemize} [nosep]
    \item Initialization
    \item Microbe and simulation domain definition
    \item Settings
    \item Run a simulation
\end{itemize} 

\subsubsection{Initialization}
\textbf{Example:}
\begin{Verbatim}[frame=single]
   atom_style   bio
   atom_modify  map array sort 1000 5.0e-7
   boundary     ff ff ff
   newton       off
   comm_modify  vel yes
   ...
\end{Verbatim}

Set parameters that need to be defined before microbes are created or read-in from a file. 
Most of the commands for the initialization are the pre-existing LAMMPS commands: \\
\begin{itemize} [nosep]
    \item \hyperref[atomstyle]{\tt atom\_style} command: define what style and attributes of atoms to use in the simulation. 
    \item \href{http://lammps.sandia.gov/doc/atom_style.html}{\tt atom\_modify} commands: modify certain attributes of atoms defined and stored within NUFEB, in addition to what is specified by the atom\_style command. 
    \item \href{http://lammps.sandia.gov/doc/boundary.html}{\tt boundary} command: set the style of boundaries for the simulation domain in each dimension. 
    \item \href{http://lammps.sandia.gov/doc/newton.html}{\tt newton} command: turns Newton's 3rd law on or off for pairwise and bonded interactions. 
    \item \href{http://lammps.sandia.gov/doc/comm_modify.html}{\tt comm\_modify} command: sets parameters that affect the inter-processor communication of atom information.\\
\end{itemize} 

\subsubsection{Microbe, nutrient and simulation domain definition}
\textbf{Example:}
\begin{Verbatim}[frame=single]
    ...
    read_data_bio atom.in
    ...
\end{Verbatim}

In NUFEB, we use 
\hyperref[readdata]{\tt read\_data\_bio} command
to initialize microbes, nutrients and simulation domain. 
The command reads in a data file containing information NUFEB needs to run a simulation. 

\newpage
\subsubsection{Settings}
\textbf{Example:}
\begin{Verbatim}[frame=single]
  ...
  group HET type 1
  ...
  neighbor       5.0e-7 bin
  neigh_modify   delay 0 one 5000
  pair_style  gran/hooke/history 1.e-4 NULL 1.e-5 NULL 0.0 1
  
  timestep 10
  
  variable EPSdens equal 30
  
  fix fnl all nve/limit 1e-8 
  fix fv all viscous 1e-5
  fix d1 all divide 100 v_EPSdens v_divMass 31231
  ...
  dump id all custom 10 output.lammps id type diameter x y z
  ...
\end{Verbatim}

Once initial microbes, nutrients and simulation domain are defined, a variety of settings can be specified: force field, biological processes, chemical processes, output options, etc. The list below is the
summary of the commands that can be used for a NUFEB simulation.\\

\noindent\textbf{Pre-existing LAMMPS commands}\\
\begin{itemize} [nosep]
    \item \href{http://lammps.sandia.gov/doc/group.html}{\tt group} command: identify a collection of atoms (microbes) as belonging to a group. The group ID can then be used in other commands such as fix, compute, or dump to act on those atoms together.
    \item \href{http://lammps.sandia.gov/doc/neighbor.html}{\tt neighbor} command: set parameters that affect the building of pairwise neighbor lists.
    \item \href{http://lammps.sandia.gov/doc/neigh_modify.html}{\tt neigh\_modify} command: set parameters that affect the building and use of pairwise neighbor lists.
    \item \href{http://lammps.sandia.gov/doc/timestep.html}{\tt timestep} command: set the timestep size for subsequent molecular dynamics simulations (units: s).
    \item  \href{http://lammps.sandia.gov/doc/pair_gran.html}{\tt pair\_style gran/hooke/history} command: set formulas for the contact force between two granular particles.
    \item \href{http://lammps.sandia.gov/doc/variable.html}{\tt variable} command: assign one or more strings to a variable name for evaluation later in the input script or during a simulation.
    \item \href{http://lammps.sandia.gov/doc/fix.html}{\tt fix} command: set a fix that will be applied to a group of atoms. In LAMMPS, a ``fix'' is any operation that is applied to the system during timestepping.
    \item \href{http://lammps.sandia.gov/doc/fix_nve_limit.html}{\tt fix nve/limit} command: perform constant NVE updates of position and velocity for atoms in the group each timestep.
    \item \href{http://lammps.sandia.gov/doc/fix_viscous.html}{\tt fix viscous} command: add a viscous damping force to atoms in the group that is proportional to the velocity of the atom.
    \item \href{http://lammps.sandia.gov/doc/fix_wall_gran.html}{\tt fix wall/gran} command: bound the simulation domain of a granular system with a frictional wall.
    \item \href{http://lammps.sandia.gov/doc/compute.html}{\tt compute} command: define a computation that will be performed on a group of atoms. 
    \item \href{http://lammps.sandia.gov/doc/dump.html}{\tt dump custom} command: dump a snapshot of atom quantities to one or more files every N timesteps.
    \item \href{http://lammps.sandia.gov/doc/thermo.html}{\tt thermo} command: compute and print thermodynamic info (e.g. temperature, energy, pressure) on timesteps at the beginning and end of a simulation. 
    \item \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style} command: set the style and content for printing thermodynamic data to the screen and log file.
    \\
\end{itemize} 

\noindent\textbf{NUFEB commands}\\
\begin{itemize} [nosep]
    \item \hyperref[fkinetics]{\tt fix kinetics} command: set parameters for a variety of kinetics computations.
    \item \hyperref[fkineticsmonod]{\tt fix kinetics/growth/monod} command: perform microbe growth and decay based on Monod kinetic.
    \item \hyperref[fkineticsenergy]{\tt fixkinetics/growth/energy} command: perform microbe growth and decay based on metabolic energy.
    \item \hyperref[divide]{\tt fix divide} command: perform microbe division.
    \item \hyperref[epsextract]{\tt fix eps\_extract} command: perform EPS production process on HET.
    \item \hyperref[death]{\tt fix death} command: perform microbe death process.
    \item \hyperref[fkineticsph]{\tt fix kinetics/ph} command: add the calculations of pH, iron strength and nutrient activity that effect the energy-based growth kinetics.
    \item \hyperref[fkineticsthermo]{\tt fix kinetics/thermo} command: add thermodynamic and liquid-gas transfer calculations that effect the energy-based growth kinetics.
    \item \hyperref[fkineticsdiffusion]{\tt fix kinetics/diffusion} command: solve mass balance of soluble substrates in biofilm and bulk liquid.	
    \item \hyperref[epsadh]{\tt fix epsadh} command: bound microbes with EPS adhesive force
    \item \hyperref[walladh]{\tt fix walladh} command: impose an adhesive force between wall and the microbes attaching to the wall.
    \item \hyperref[shear]{\tt fix shear} command: impose an additional shear force for each microbe in the group.  
    \item \hyperref[cntypes]{\tt compute ntypes} command: define a computation that calculates total number of each species in the system.
    \item \hyperref[cbiomass]{\tt compute biomass} command:  define a computation that calculates total biomass of each species in the system.
    \item \hyperref[cdiameter]{\tt compute diameter} command: define a computation that calculates floc equivalent diameter.
    \item \hyperref[cdimension]{\tt compute dimension} command: define a computation that calculates fractal dimension.
    \item \hyperref[cdiversity]{\tt compute diversity} command: define a computation that calculates diversity index of all species in the system
    \item \hyperref[caveheight]{\tt compute ave\_height} command: define a computation that calculates biofilm average height.
    \item \hyperref[croughness]{\tt compute roughness} command: define a computation that calculates biofilm roughness.    
    \item \hyperref[csegregation]{\tt compute segregation} command: define a computation that calculates biofilm segregation index.
    \item \hyperref[dumpbio]{\tt dump bio} command: dump microbe, biofilm, floc and kinetics information to files. 
\end{itemize} 

\subsubsection{Run a simulation}
\textbf{Example:}
\begin{Verbatim}[frame=single]
   ...
   run  10000
\end{Verbatim}

A molecular dynamics simulation is run using the 
\href{http://lammps.sandia.gov/doc/run.html}{\tt run}
 command. 

\subsection{atom\_style command}
\label{atomstyle}
\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
   atom_style bio
\end{Verbatim}

\begin{itemize}
\item
	{\it bio}: atom style for IBm simulation
\end{itemize}

\subsubsection*{Description}

Define a biological atom style used in IBm simulation. Classical LAMMPS provides different atom types that could be used by user. These are specified in the input script by the command: \href{http://lammps.sandia.gov/doc/atom_style.html}{\tt atom\_style}. Command must be used before a simulation is setup via \hyperref[readdata]{\tt read\_data\_bio} command. A newer {\tt atom\_style} is added (named "bio") to increase the number of attribute. The new {\tt atom\_style} is inherited from already existing {\tt atom\_style sphere}. 

\newpage
\subsection{read\_data\_bio command}
\label{readdata}

Read in a data file containing information NUFEB needs to run a simulation, 
i.e, microbe, species, nutrient and computation domain. 
The file can be ASCII text or a gzipped text file (detected by a .gz suffix). 
The structure of the data file is important, 
though many settings and sections are optional or can come in any order.
A typical example is the data file ``atom.in ''
in {\tt NUFEB/examples/biofilm-monod-low/} directory.\\


\noindent {\bf Format of the header of a data file}\\

A data file has a header and a body. The header appears first. 
The first line of the header is always skipped; it typically contains a description of the file.
Lines can have a trailing comment starting with `\#' that is ignored. If the line is blank (only whitespace after comment is deleted), it is skipped. If the line contains a header keyword, the corresponding value(s) is read from the line. If it doesn't contain a header keyword, the line begins the body of the file.

These are the recognized header keywords. Header lines can come in any order. The value(s) are read from the beginning of the line. Thus the keyword atoms should be in a line like ``44 atoms''; the keyword ylo yhi should be in a line like``0.0  1.0e-04 ylo yhi''. The following list is the headers that are required for running a NUFEB simulation. \\

\begin{itemize} [nosep]
    \item atoms = \# of atoms (microbes) in system
    \item atom types = \# of types (microbial species) in system
    \item nutrients = \# of nutrients in system
    \item xlo xhi = simulation box boundaries in x dimension
    \item ylo yhi = simulation box boundaries in y dimension
    \item zlo zhi = simulation box boundaries in z dimension\\
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
  IBm Simulation 

   44   atoms 
   5    atom types 
   5    nutrients
    
   0.0  1.0e-04  xlo xhi 
   0.0  4.0e-05  ylo yhi 
   0.0  1.0e-04  zlo zhi 
     
   ...
\end{Verbatim}

\noindent {\bf Format of the body of a data file}\\

The body of the file contains zero or more sections. The first line of a section has only a keyword. 
The next line is skipped. The remaining lines of the section contain values. 
The number of lines depends on the section keyword as described below. Zero or more blank lines can be used between sections. Sections can appear in any order, with a few exceptions as noted in the following sections.

These are the section keywords for the body of the file.\\
\begin{itemize} [nosep]
    \item Atoms, Growth Rate, Consumption Rate, Yield Coeffs, Maintenance, Decay Rate, Electron Donor, Dissipation.
    \item Nutrients, Diffusion Coeffs, Mass Transfer Coeffs.
    \item Ks, Catabolism Coeffs, Anabolism Coeffs, Decay Coeffs, Nutrient Activity Coeffs, Type Activity Coeffs,  Charge Number.
\end{itemize} 

\subsubsection{Atoms section}
\label{satom}

\begin{itemize} [nosep]
    \item one line per atom
    \item line syntax: atom-ID {} type-ID {} inner-diameter {} density {} x {} y {} z {} outer-diameter {} type-name
    \item unit: diameter (m), density (kg m\textsuperscript{-3}) \\
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
   Atoms
   
     1 1 1.0e-6 150 0.5e-5 0.5e-5 1e-6 1.2e-6 het
     2 2 1.0e-6 150 1.5e-5 0.5e-5 1e-6 1.0e-6 aob

\end{Verbatim}

Define initial atoms (microbes) and types (microbial species) in the system. The Atoms section must appear before all other sections in the data file. The atoms can be listed in any order. For {\tt atom\_style bio}, the particles are spheres. atom-ID is used to identify the atom throughout the simulation and in dump files. Normally, it is a unique value from 1 to Natoms for each atom. The type-ID is a 2nd identifier attached to an atom. Normally, it is a number from 1 to N, identifying which species the microbe belongs to. The inner-diameter and outer-diameter specify the inner and outer sizes of a finite-size spherical microbe. Organism such as Heterotroph (HET) excretes Extracellular Polymeric Substances (EPS) which is initially
accumulated as a extra shell beyond the particle. The outer-diameter of these species is the initial size of EPS shell which must be greater or equal than the inner-diameter. For the species that do not produce EPS, their outer-diameter should be equal to the inner-diameter. The density is used in conjunction with the particle volume to set the mass of each particle as mass = density $\times$ volume. x,y,z specify the (x,y,z) coordinates of atoms. These must be inside the simulation box. Finally, type-name assigns a string to each species to which the atom belongs. The type-name must be in accordance with the type-ID. The type-name is used to define species attribute parameters in other sections.


\subsubsection{Nutrients section}
\label{snutrients}

\begin{itemize} [nosep]
    \item one line per nutrient
    \item line syntax: nutrient-ID {} nutrient-name {} nutrient-status=g/l {} S\textsubscript{domain} {} S\textsubscript{bc-xlo} {} S\textsubscript{bc-xhi} {} S\textsubscript{bc-ylo} {} S\textsubscript{bc-yhi} {} S\textsubscript{bc-zlo} {} S\textsubscript{bc-zhi}     
    \item units: {\tt fix kinetics/growth/energy} = mol L\textsuperscript{-1};\\  
    {\tt fix kinetics/growth/monod} =  kg m\textsuperscript{-3}\\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Nutrients

     1 o2 l 0.002 0.002 0.002 0.002 0.002 0.002 0.002
     2 go2 g 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3

\end{Verbatim}

Define nutrients and their inlet concentrations in the system.
The Nutrients section must appear before all other sections except \hyperref[satom]{\tt Atoms} section in the data file.
nutrient-ID is used to identify the nutrient throughout the simulation.
The nutrient-ID is a 2nd identifier attached to a nutrient. Normally, it is a number from 1 to N.
nutrient-name assigns a string to each nutrient which is used to define nutrient attribute parameters in 
other sections.
nutrient-status can be either l (liquid) or g (gas).
It is suggested that the nutrient-name of any gas nutrient should start with prefix `g', e.g, go2 or gco2.
S\textsubscript{domain} defines the inlet concentration of each nutrient within the simulation domain.
 S\textsubscript{bc-xlo} {} S\textsubscript{bc-xhi} {} S\textsubscript{bc-ylo} {} S\textsubscript{bc-yhi} {} S\textsubscript{bc-zlo} {} S\textsubscript{bc-zhi} define the inlet concentrations of each nutrient in six boundary surfaces. The units of concentration depends on the growth command used for the simulation. $S$ is considered to be mol L\textsuperscript{-1} if \hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy} command  is used,
while $S$ is in kg m\textsuperscript{-3} if \hyperref[fkineticsmonod]{\tt fix kinetics/growth/monod} is used.  


\subsubsection{Growth Rate section}
\label{sgrowth}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value 
    \item units: s\textsuperscript{-1}  \\
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Growth Rate

     het 0.0000695
     aob 0.0000088

\end{Verbatim}

Define maximum specific growth rate of each species.  The Growth Rate section must be defined if 
\hyperref[fkineticsmonod]{\tt fix kinetics/growth/monod} command is used for the simulation.


\subsubsection{Yield Coeffs section}
\label{syield}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value 
    \item units: {\tt fix kinetics/growth/energy} = mol mol\textsuperscript{-1};\\  {\tt fix kinetics/growth/monod} =  kg kg\textsuperscript{-1}\\
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Yield Coeffs

     het 0.61
     aob 0.33

\end{Verbatim}

Define yield coefficient of each species.  The Yield Coeffs section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy} or \hyperref[fkineticsmonod]{\tt fix kinetics/growth/monod} command is used for the simulation. 

\subsubsection{Consumption Rate section}
\label{sconsum}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value 
    \item units: mol mol\textsuperscript{-1} s\textsuperscript{-1}  \\
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Consumption Rate

    aob 0.000283611
    nob 0.000702222

\end{Verbatim}

Define maximum specific nutrient consumption rate of each species.  The Consumption Rate section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy} command is used for the simulation. 

\subsubsection{Maintenance section}
\label{smaintain}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value 
    \item units: {\tt fix kinetics/growth/energy} = mol mol\textsuperscript{-1} s\textsuperscript{-1};\\  
    {\tt fix kinetics/growth/monod} =  s\textsuperscript{-1}\\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Maintenance

    aob 0.000123376
    nob 0.000134422

\end{Verbatim}

Define maintenance rate of each species.  The Maintenance section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy} or \hyperref[fkineticsmonod]{\tt fix kinetics/growth/monod} 
command is used for the simulation. 


\subsubsection{Decay Rate section}
\label{sdecay}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value 
    \item units: s\textsuperscript{-1} \\  
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Decay Rate

    aob 0.000003694
    nob 0.00000127314

\end{Verbatim}

Define decay rate of each species.  The Decay Rate section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy} or \hyperref[fkineticsmonod]{\tt fix kinetics/growth/monod} 
command is used for the simulation. 

\newpage
\subsubsection{Electron Donor section}
\label{sed}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value \\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Electron Donor

     aob 0.9
     nob 2.9

\end{Verbatim}

Define electron donor of each species. 
The Electron Donor section must be defined if 
\hyperref[fkineticsthermo]{\tt fix kinetics/thermo} 
command is used with the argument $f\_yield$ = unfix. 


\subsubsection{Dissipation section}
\label{sdiss}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value 
    \item units: kJ mol\textsuperscript{-1} \\  
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Dissipation

    aob 3500
    nob 3500

\end{Verbatim}

Define dissipation constant of each species. 
The Dissipation section must be defined if 
\hyperref[fkineticsthermo]{\tt fix kinetics/thermo} 
command is used with the argument $f\_yield$ = unfix. 

\newpage
\subsubsection{Diffusion Coeffs section}
\label{sdiffusion}
\begin{itemize} [nosep]
    \item one line per nutrient
    \item line syntax: nutrient-name {} value 
    \item units: m\textsuperscript{2} s\textsuperscript{-1} \\  
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Diffusion Coeffs

     o2 2e-9
     go2 0

\end{Verbatim}

Define diffusion coefficient of each nutrient. 
The Diffusion Coeffs section must be defined if 
\hyperref[fkineticsdiffusion]{\tt fix kinetics/diffusion} 
command is used for the simulation. 


\subsubsection{Mass Transfer Coeffs section}
\label{skla}
\begin{itemize} [nosep]
    \item one line per nutrient
    \item line syntax: nutrient-name {} value 
    \item units: s\textsuperscript{-1} \\  
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Mass Transfer Coeffs

     o2 0.0056
     go2 0.0056

\end{Verbatim}

Define mass transfer coefficient (KLa) of each nutrient. 
The Mass Transfer Coeffs section must be defined if 
\hyperref[fkineticsthermo]{\tt fix kinetics/thermo}
command is used with the argument $f\_reaction$=close. 


\newpage
\subsubsection{Ks section}
\label{sks}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value-1 value-2 ... value-Nnutrient
    \item units: {\tt fix kinetics/growth/energy} = mol L\textsuperscript{-1};\\  
    {\tt fix kinetics/growth/monod} =  kg m\textsuperscript{-3}\\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Nutrients

     1 nh3 l 0.002 0.002 0.002 0.002 0.002 0.002 0.002
     4 o2 l 2.8e-4 2.8e-4 2.8e-4 2.8e-4 2.8e-4 2.8e-4 2.8e-4
     
 Ks
     
     aob 1.71e-04 1.88e-05

\end{Verbatim}

Define half-velocity constants of each species. 
The Ks section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy} or 
\hyperref[fkineticsmonod]{\tt fix kinetics/growth/monod} 
command is used for the simulation. 
The order of the Ks values of each species must be consistent 
with the nutrient IDs defined in the \hyperref[snutrients]{\tt Nutrients} section.
In the above example, Ks\textsubscript{nh3}=1.71e-04, and Ks\textsubscript{o2}=1.88e-05.
Ks\textsubscript{nutrient}=0 means that the nutrient will not be taken into account
when solving Monod equation.


\subsubsection{Catabolism Coeffs section}
\label{scata}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value-1 value-2 ... value-Nnutrient\\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Nutrients

     1 nh3 l 0.002 0.002 0.002 0.002 0.002 0.002 0.002
     2 no2 l 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3
     
 Catabolism Coeffs
         
     aob -1 1

\end{Verbatim}

Define catabolism coefficients of each species. 
The section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy}
or
\hyperref[fkineticsthermo]{\tt fix kinetics/thermo}
command is used for the simulation. 
The order of the coefficients of each species must be consistent 
with the nutrient IDs defined in the \hyperref[snutrients]{\tt Nutrients} section.


\subsubsection{Anabolism Coeffs section}
\label{sana}
\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} value-1 value-2 ... value-Nnutrient\\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Nutrients

     1 nh3 l 0.002 0.002 0.002 0.002 0.002 0.002 0.002
     2 no2 l 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3
     
 Catabolism Coeffs
         
     aob -0.9 0.7

\end{Verbatim}

Define anabolism coefficients of each species. 
The section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy}
or
\hyperref[fkineticsthermo]{\tt fix kinetics/thermo}
command is used for the simulation. 
The order of the coefficients of each species must be consistent 
with the nutrient IDs defined in the \hyperref[snutrients]{\tt Nutrients} section.     
     

\subsubsection{Decay Coeffs section}
\label{sdecaycoeffs}
\begin{itemize} [nosep]
    \item one line per species
    \item line syntax: species-name {} value-1 value-2 ... value-Nnutrient\\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Nutrients

     1 nh3 l 0.002 0.002 0.002 0.002 0.002 0.002 0.002
     2 no2 l 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3
     
 Decay Coeffs
         
     aob -0.9 0.7

\end{Verbatim}

Define decay coefficients of each species. 
The section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy}
or
\hyperref[fkineticsmonod]{\tt fix kinetics/growth/monod}
command is used for the simulation. 
The order of the coefficients of each species must be consistent 
with the nutrient IDs defined in the \hyperref[snutrients]{\tt Nutrients} section.


\subsubsection{Nutrient Activity Coeffs section}
\label{sactivitycoeff}

\begin{itemize} [nosep]
    \item one line per nutrient
    \item line syntax: nutrient-name {} not-hydrated-form {} fully-protonated0form {} 1\textsuperscript{st}-deprotonated-form {} 2\textsuperscript{nd}-deprotonated-form {} 3\textsuperscript{rd}-deprotonated-form {} form-flag \\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Nutrient Activity Coeffs

    nh3 inf -79.37 -26.57 inf inf 3

\end{Verbatim}

Define nutrient activity coefficients used in deprotonations calculation.
The section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy}
command is used for the simulation. 

\subsubsection{Type Activity Coeffs section}
\label{stactivitycoeff}

\begin{itemize} [nosep]
    \item one line per type
    \item line syntax: type-name {} not-hydrated-form {} fully-protonated0form {} 1\textsuperscript{st}-deprotonated-form {} 2\textsuperscript{nd}-deprotonated-form {} 3\textsuperscript{rd}-deprotonated-form {} form-flag \\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Type Activity Coeffs

    aob inf -67 inf inf inf 2

\end{Verbatim}

Define type activity coefficients used in deprotonations calculation.
The section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy}
command is used for the simulation. 

\newpage
\subsubsection{Charge Number section}
\label{scharge}
\begin{itemize} [nosep]
    \item one line per nutrient
    \item line syntax: nutrient-name {} not-hydrated-form {} fully-protonated0form {} 1\textsuperscript{st}-deprotonated-form {} 2\textsuperscript{nd}-deprotonated-form {} 3\textsuperscript{rd}-deprotonated-form \\
    
\end{itemize} 

\textbf{Example:}
\begin{Verbatim}[frame=single]
 Charge Number

    nh3 na 1 0 na na
    no2 na 0 -1 na na

\end{Verbatim}

Define the charge number of the ion used in ionic strength calculation.
The section must be defined if 
\hyperref[fkineticsenergy]{\tt fix kinetics/ph}
command is used for the simulation. 


\newpage

\subsection{fix kinetics command}
\label{fkinetics}

\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID kinetics Nevery nx ny nz v_temp v_Rth v_Vgas 
v_Rg v_pH v_diffT v_bl
\end{Verbatim}
	
\begin{itemize} [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it kinetics }: style name of this fix command
\item
	{\it Nevery }: call kinetics-related functions every this many timesteps
\item
	{\it nx, ny, nz }: number of grid elements, x, y, z planes
\item
	{\it v\_temp }: temperature (K)
\item 
	{\it v\_Rth }: universal gas constant for thermodynamics (kJ mol\textsuperscript{-1} K\textsuperscript{-1} )
\item 
	{\it v\_Vgas }: gas volume (L)
\item 
	{\it v\_Rg }: universal gas constant for gas transfer (atm L mol\textsuperscript{-1} K\textsuperscript{-1} )
\item 
	{\it v\_pH }: pH
\item 
	{\it v\_diffT }: diffusion timestep (s)
\item 
	{\it v\_bl }: thickness of boundary layer (m)	 	 	
\end{itemize}

\subsubsection*{Required data sections}
\hyperref[satom]{\tt Atoms}, \hyperref[snutrients]{\tt Nutrients}, \hyperref[sactivitycoeff]{\tt Nutrient activity Coeffs$^*$} sections \\

\noindent $*$ If \hyperref[fkineticsenergy]{\tt fix kinetics/growth/energy} command is used.
\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
variable temp equal 298.15
...
fix k1 all kinetics 100 60 12 30 v_temp v_Rth v_Vgas v_Rg
v_pH v_diffT v_bl
\end{Verbatim}

\subsubsection*{Description}

Set parameters and perform initializations for kinetics-related functions. {\it nx, ny, nz }
set the number of grid elements in each of the $x, y$, and $z$ directions, respectively. Note that in NUFEB the $x$
and $y$ directions represent the two horizontal directions and $z$ is the vertical direction. The algorithms
used to solve for the nutrient concentration and other chemistry fields require the equal width of each
side of each grid. For example, for the simulation domain with $size = 1\mathrm{e}{-4} \times 5\mathrm{e}{-5} \times 1\mathrm{e}{-4}, nx = 20, ny = 10, nz = 20$ is a valid partition. 

If \hyperref[fkineticsenergy]{\tt kinetics/growth/energy} command is used for the simulation, the {\tt kinetics} command initializes 
thermodynamic equilibrium constant ($K_{eq}$) and activity of the chemical species.
The $K_{eq}$ is calculated through
the Gibbs free energy values of formation at standard conditions:

\[ K_{eq} = e^{-\frac{\Delta G^0}{R_{th}T}} \] 

where $T$ and $R_{th}$ refer to the temperature and the universal constant of gasses given in the command parameters.
While the activity of the chemical species in solution is calculated though generalised equations for any number of deprotonations which is depending on {\it v\_pH }, $K_{eq}$, 
activity coefficients (defined in \hyperref[sactivitycoeff]{\tt Activity Coefficients} section) and total concentration of each chemical component (defined in \hyperref[snutrients]{\tt Nutrients} section). See (González-Cabaleiro R {\it et al}.) for more details.


The parameters {\it v\_Vgas } and {\it v\_Rg} are used 
in \hyperref[fkineticsthermo]{\tt fix kinetics/thermo} command for the calculation of liquid-gas transfer. 
Note that {\it v\_temp}, {\it v\_Rth}, {\it v\_Vgas}, {\it v\_Rg} 
and {\it v\_pH} are the parameters only used for energy-based growth model. 
You can ignore those variables by, for example, set the values to 0 when 
\hyperref[fkineticsmonod]{\tt kinetics/growth/monod} command is used. 

{\it v\_bl } defines thickness of boundary layer between the biofilm and the bulk. This boundary layer forms part of the
pure liquid region within the domain, and in this region only diffusion governs the local concentration.
Beyond the boundary layer region the liquid is assumed to be well-mixed, and so the solute concentrations are
kept equal to their concentration in an attached bulk compartment. Note that if {\it v\_bl } is less or equal than zero or greater than $zhi$, it is assumed that the boundary layer region is undefined.

\noindent\rule{13cm}{0.4pt}
González-Cabaleiro R {\it Basis towards an accurate description of physicochemical reactions when modelling bioprocesses}
\newpage

\subsection{fix kinetics/growth/monod command}
\label{fkineticsmonod}

\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID kinetics/growth/monod v_EPSdens v_etaHET
\end{Verbatim}

\begin{itemize} [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it kinetics/growth/monod }: style name of this fix command
\item
	{\it v\_EPSdens  }: EPS density (kg m\textsuperscript{-3})
\item
	{\it v\_etaHET }: reduction factor in anoxic conditions
	 	
\end{itemize}

\subsubsection*{Required data sections}
\hyperref[satom]{\tt Atoms}, \hyperref[snutrients]{\tt Nutrients}, 
\hyperref[sgrowth]{\tt Growth Rate},
\hyperref[syield]{\tt Yield Coeffs},
\hyperref[smaintain]{\tt Maintenance},
\hyperref[sks]{\tt Ks},
\hyperref[sdecay]{\tt Decay Rate}  sections \\

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
variable EPSdens equal 30
variable etaHET equal 0.6

fix kgm all kinetics/growth/monod v_EPSdens v_etaHET
\end{Verbatim}

\subsubsection*{Description}
Perform microbe growth and decay based on basic Monod kinetics.
The growth and decay of active microbes and decay of 
inactive microbe of biomass are calculated using the following growth kinetic equation: 

\[ \frac{dm_i}{d_t} = r_im_i \] 

where $m_i$ is the mass of the particulate microbe and $r_i$ is the specific growth/decay rate.
The specific growth rate is determined by Monod kinetic equation and decay is assumed to be the first order.
Details of specific growth/decay rates for various processes can be found in (PG Jayathilake {\it et al. 2017})

The function implements growth/decay models for five commonly found microbial functional groups:
Heterotrophs (HET), Ammonia oxidizing bacteria (AOB),
Nitrogen oxidizing bacteria (NOB), Extracellular polymeric substances (EPS)
and Dead microbes (DEAD). Other species cannot be defined in the data file if the simulation is using this command.
For the active microorganisms HET, AOB and NOB, 
NUFEB-2.0 supports to define multi-species within the same functional group. 
The choice of their growth models is determined by 
the first three characters of the species name defined in 
\hyperref[satom]{\tt Atoms} section.
For example, you can define two species (types) ``hetr'' and ``hety''
with different growth rates and yields in data file. 
In this case, the growth/decay for both species
are based on HET growth model. 

The function also calculates consumption rate $R$ for each microbe 
based on the nutrient concentration of the grid where the 
microbe belongs to. The results will be used for solving diffusion-reaction equation
in \hyperref[fkineticsdiffusion]{\tt kinetics/diffusion} function.

\noindent\rule{13cm}{0.4pt}

P.G. Jayathilake, P. Gupta, B. Li, C. Masden, O. Oyebamiji, R. González-Cabaleiro, S. Rushton, B. Bridgens, D. Swailes, B. Allen, S. McGough, P. Zuliani, I.D. Ofiteru, D. Wilkinson, J. Chen, T. Curtis
{\it A mechanistic individual-based model of microbial communities}
PLOS One, 12 (8) (2017)

\newpage
\subsection{fix kinetics/growth/energy command}
\label{fkineticsenergy}

\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID kinetics/growth/energy v_EPSdens 
\end{Verbatim}

\begin{itemize} [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it kinetics/growth/energy }: style name of this fix command
\item
	{\it v\_EPSdens  }: EPS density (kg m\textsuperscript{-3})
	 	
\end{itemize}

\subsubsection*{Required data sections}
\hyperref[satom]{\tt Atoms}, 
\hyperref[snutrients]{\tt Nutrients}, 
\hyperref[sconsum]{\tt Consumption Rate},
\hyperref[syield]{\tt Yield Coeffs},
\hyperref[smaintain]{\tt Maintenance},
\hyperref[sks]{\tt Ks},
\hyperref[scata]{\tt Catabolism Coeffs},
\hyperref[sana]{\tt Anabolism Coeffs},
\hyperref[sdecay]{\tt Decay Rate}  sections. \\

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
variable EPSdens equal 30

fix kge all kinetics/growth/energy v_EPSdens
\end{Verbatim}

\subsubsection*{Description}

Perform microbe growth and decay based on metabolic energy. 
The growth of each bacteria is described by calculating the amount of energy available for its
metabolism in each grid element of the reactor. 
\[ \mu = Y^{max} \cdot (q^{met} - m^{req}) {}\text{  if  } q > m\]
\[ \mu = 0 {} \text{   if  } q = m\]
\[ \mu = -k_d \frac{q^{met} - m^{req}}{m^{req}} {} \text{  if  } q < m\]
The maximum growth yield $Y^{max}$ is calculated using the Energy Dissipation Method 
implemented in \hyperref[fkineticsthermo]{\tt fix kinetics/thermo} command.
$m^{req}$ is the average maintenance energy defined in \hyperref[smaintain]{\tt Maintenance} section.
$q^{met}$ is metabolic rate calculated based on Monod kinetics. 
Then, growth is considered only if the cell is harvesting more energy than the necessary
to maintain. Otherwise, microbe will maintain or decay linearly with the lack of
energy with a constant. The function also calculates consumption rate $R$ for each microbe 
based on the nutrient concentration of the grid where the 
microbe belongs to. The results will be used for solving diffusion-reaction equation
in \hyperref[fkineticsdiffusion]{\tt kinetics/diffusion} function.


\newpage
\subsection{fix kinetics/ph command}
\label{fkineticsph}

\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID kinetics/ph 
\end{Verbatim}

\begin{itemize} [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it kinetics/ph  }: style name of this fix command

\end{itemize}

\subsubsection*{Required data sections}
\hyperref[snutrients]{\tt Nutrients},
\hyperref[scharge]{\tt Charge Number}  sections. \\

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
fix kge all kinetics/ph
\end{Verbatim}

\subsubsection*{Description}

Perform the calculations of pH, ionic strength and activities of all chemical species in the liquid solution.
A Newton-Raphson implicit method is implemented to resolve the solution. 
A detailed description of the implemented algorithm can be found in (González-Cabaleiro R {\it et al}.).

\noindent\rule{13cm}{0.4pt}
González-Cabaleiro R {\it Basis towards an accurate description of physicochemical reactions when modelling bioprocesses}
\newpage


\newpage
\subsection{fix kinetics/thermo command}
\label{fkineticsthermo}

\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID kinetics/thermo f_yield f_reactor v_pressure
\end{Verbatim}

\begin{itemize} [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it kinetics/thermo }: style name of this fix command
\item
	{\it f\_yield }: dynamic yield flag ({\it s\_yield = fix or unfix})
\item
	{\it f\_reactor }: reactor status flag ({\it s\_reactor = open or close})
\item
    {\it v\_pressure}: gas partial pressure (bar)
\end{itemize}

\subsubsection*{Required data sections}
\hyperref[satom]{\tt Atoms}, 
\hyperref[snutrients]{\tt Nutrients}, 
\hyperref[scata]{\tt Catabolism Coeffs},
\hyperref[sana]{\tt Anabolism Coeffs},
\hyperref[sactivitycoeff]{\tt Nutrient Activity Coeffs},
\hyperref[stactivitycoeff]{\tt Type Activity Coeffs},
\hyperref[sdiss]{\tt Dissipation$^{*}$},
\hyperref[skla]{\tt Mass Transfer Coeffs$^{**}$},
\hyperref[sed]{\tt Electron Donor$^{*}$} sections. \\

\noindent $*$ If $f\_yield = unfix$.\\
\noindent $**$ If $f\_reactor = close$.

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
fix kge all kinetics/thermo
\end{Verbatim}

\subsubsection*{Description}

Calculate Gibbs free energy and liquid-gas transfer that effect the energy-based growth kinetics.
The Gibbs free energy of catabolism $\Delta G_{cat}$ and anabolism $\Delta G_{ana}$  is given by:
\[ \Delta G = \Delta G_0 + R_{th}T(M^Tln(a))\]
where $R_{th}$ and $T$ are universal gas constant and temperature defined in 
\hyperref[fkinetics]{\tt fix kinetics} command respectively. $M$ is the catabolism and anabolism coefficients 
derived from \hyperref[scata]{\tt Catabolism Coeffs} and \hyperref[sana]{\tt Anabolism Coeffs} sections.
$a$ is the nutrient activity calculated in \hyperref[fkineticsph]{\tt fix kinetics/ph} command. 

If a variable $f\_yield = $ unfix is selected, a dynamic yield value can be calculated
at each grid element.
The catabolic and anabolic energy values can be used to derive the catabolic reaction equation:
\[\lambda_{cat} = -\frac{\Delta G_{ana} + \Delta G_{dis}}{\Delta G_{cat}} + eD\]
where $\Delta G_{dis}$ is the dissipation constant defined in 
\hyperref[sdiss]{\tt Dissipation} section and eD is electron donor defined in
\hyperref[sed]{\tt Electron Donor} section.
This is equivalent to the inverse yield:
\[Y_i = \frac{1}{\lambda_{cat}} \]

Variable $f\_reactor = $ close triggers the gas field to be considered in the simulation domain. The command implements a gas-liquid transfer algorithm for the solution.

\newpage
\subsection{fix kinetics/diffusion command}
\label{fkineticsdiffusion}

\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID kinetics/diffusion v_shearRate v_tol v_Q 
v_rvol v_Af f_xbc f_ybc f_zbc f_units
\end{Verbatim}

\begin{itemize} [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it kinetics/diffusion }: style name of this fix command
\item
	{\it v\_shearRate }: effects of shear rate on the diffusion
\item
	{\it v\_tol }: absolute tolerance to detect convergence
\item
    {\it v\_Q}: volumetric flow rate (m\textsuperscript{3} s\textsuperscript{-1})
\item
    {\it v\_rvol}: volume of biofilm reactor (m\textsuperscript{3})
\item
    {\it v\_Af}: total biofilm area in the reactor (m\textsuperscript{2})
\item
    {\it f\_xbc, f\_ybc, f\_zbc}: boundary condition mode flag on x, y and z planes ({\it f\_xbc = f\_ybc = f\_zbc = nn or nd or pp or dn or dd})
\item
    {\it f\_units}: concentration units used in the command ({\it units = mol or kg})
    
\end{itemize}

\subsubsection*{Required data sections} 
\hyperref[snutrients]{\tt Nutrients}, 
\hyperref[sdiffusion]{\tt Diffusion Coeffs} sections. 
\\

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
variable shearRate equal 0.0
variable tol equal 1e-6
...
fix kd all kinetics/diffusion v_shearRate v_tol v_Q v_rvol 
v_Af pp pp nd mol
\end{Verbatim}

\subsubsection*{Description}

Solve mass balance of soluble substrates in biofilm and bulk liquid.
Nutrient distribution within the rectangular 
simulation domain is calculated by solving the 
advection-diffusion-reaction equation for each soluble component defined in 
\hyperref[snutrients]{\tt Nutrients} section.
For each nutrient, the mass balance equation is given by, 
\[ \frac{\partial S}{\partial t} = \triangledown  \cdot (D_e \triangledown S) - \overrightarrow{U} \cdot \triangledown S + R  \] 

where $R$ is nutrient consumption rate calculated in 
\hyperref[fkineticsmonod]{\tt kinetics/growth/monod} or \hyperref[fkineticsenergy]{\tt kinetics/growth/energy} command and $D$ is the effective diffusion coefficient defined in 
\hyperref[sdiffusion]{\tt Diffusion Coeffs} section.
The equation is discretized on a Marker-And-Cell (MAC) uniform grids 
defined by $nx$, $ny$ and $nz$ in 
\hyperref[fkinetics]{\tt kinetics} command. 
The temporal and spatial derivatives of the 
transport equation are discretized by Forward Euler 
and Central Finite Differences, respectively. 
This equation is solved for the steady state solution of the concentration fields which is governed by $v\_tol$.
Six boundary conditions have been implemented in the function, 
where $n$ = Neumann, $d$ = Dirichlet and $p$ = Periodic. $f\_zbc = nd$ means Neumann in $zlo$ surface and Dirichlet in $zhi$ surface.


Mass balances for solutes in the bulk 
liquid are implemented for dynamic conditions:

\[ \frac{dS^{(b)}}{dt} = \frac{Q}{V}(S^{(in)} - S^{(out)})
+ \frac{A_f}{VL_YL_Z} \int^{L_X}_{0} \int^{L_Y}_{0} \int^{L_Z}_{0} R(x,y,z)dzdydx\] 

where $Q$ is the volumetric flow rate, $V$ is the volume of biofilm reactor, $A_f$ is 
the total biofilm area in the reactor and $L$ is the size of simulation domain. 
The equation updates the concentration in $zhi$ surface. The feature can be switched off if
the value of $v\_rvol$, $v\_Q$ or $v\_AF$ is set to negative.

{\it f\_units} defines concentration units used during the calculation. 
If \\ \hyperref[fkineticsenergy]{\tt kinetics/growth/energy} command is used, then {\it f\_units} has to be set as $mol$. If \hyperref[fkineticsmonod]{\tt kinetics/growth/monod} command is used, then {\it f\_units} has to be set as $kg$.

\newpage
\subsection{divide command}
\label{divide}
\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID divide Nevery v_EPSdens v_divMass seed
\end{Verbatim}
	
\begin{itemize} [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it divide }: style name of this fix command
\item
	{\it Nevery }: call the function every this many timesteps
\item
	{\it v\_EPSdens }: density of EPS (kg m\textsuperscript{-3})
\item
	{\it v\_divMass }: threshold mass value for microbe division (kg)
\item 
	{\it seed }: random seed for cell orientation
\end{itemize}

\subsubsection*{Required data sections} 
\hyperref[satom]{\tt Atoms} section

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
variable EPSdens equal 30
variable divMass equal 2e-16

fix d1 all divide 500 v_EPSdens v_divMass 111
\end{Verbatim}

\subsubsection*{Description}

Perform division for the microbes in group. 
The function is implemented in following way: If the mass of a microbe becomes greater than 
a user-defined value (
which is normally twice the mass of an inoculated individual bacterium), 
it divides into two daughter cells each. During the division process,
the cell mass is split in a ratio randomly selected between 0.4-0.6. This
generated two daughter cells from a parent cell. These daughter cells are
oriented randomly around the centre of the parent cell.

The {\it v\_EPSdens} setting is required for the divisions of HET
particles. Value can be floating type number.

The {\it v\_divMass} parameter defines the threshold mass value that a microbe starts dividing.

\newpage
\subsection{eps\_extract command}
\label{epsextract}
\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID eps_extract Nevery v_EPSratio v_EPSdens seed
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it eps\_extract }: style name of this fix command
\item
	{\it Nevery }: call the function every this many timesteps
\item
	{\it v\_EPSratio }: ratio between outer-radius and inner-radius of HET
\item
	{\it v\_EPSdens }: density of EPS 
\item 
	{\it seed }: random seed for cell orientation
\end{itemize}

\subsubsection*{Required data sections} 
\hyperref[satom]{\tt Atoms} section

\subsubsection*{Example}

\begin{Verbatim}[frame=single]
variable v_EPSratio equal 1.25
variable v_EPSdens equal 30
    
fix d1 HET eps_extract 500 v_EPSratio v_EPSdens 123
\end{Verbatim}

\subsubsection*{Description}

Perform EPS production process in the simulation. To use the command, a species named ``eps'' must be defined in 
\hyperref[satom]{\tt Atoms} section.

Microbes secrete extracellular polymeric substances (EPS) every so often
as a waste product of their metabolic activities. EPS is secreted into their
neighbouring environment and have known to lend structural integrity to
the biofilms. The implementation works on the common knowledge that HETs 
excrete EPS, while other microbial species do not. Initially, EPS is accumulated
as a extra shell beyond the HET particle. It should be noted that
the EPS density is much lower than the HET density. When the relative
thickness of the EPS shell bound to HET particle exceeds a certain threshold
value, i.e., {\it v\_EPSratio} value, 
almost half (random ratio between 0.4-0.6) of the EPS mass excretes
as a separate EPS particle and positions next to the HET cell.

\newpage

\subsection{death command}
\label{death}
\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID death Nevery v_deadDia
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it death }: style name of this fix command
\item
	{\it Nevery }: call the function every this many timesteps
\item
	{\it v\_deadDia }: threshold diameter value for microbe death

\end{itemize}

\subsubsection*{Required data sections} 
\hyperref[satom]{\tt Atoms} section


\subsubsection*{Example}

\begin{Verbatim}[frame=single]
variable v_deadDia equal 0.8e-6
    
fix d1 HET death 500 v_deadDia
\end{Verbatim}

\subsubsection*{Description}

Perform microbe death process in the simulation. To use the command, a species named ``dead'' must be defined in 
\hyperref[satom]{\tt Atoms} section.

The size of microbe decreases when there is not enough nutrient to uptake. Microbe dies if a threshold is reached. The $v\_deadDia$ defines how small a microbe may become before changing the type to DEAD. We assume that there is no biological activity in dead microbes and their sizes remain unchanged. 

\newpage
\subsection{epsadh command}
\label{epsadh}
\subsubsection*{Syntax}

\begin{Verbatim}[frame=single]
fix ID group-ID epsadh Nevery v_ke f_adhmodel
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it epsadh }: style name of this fix command
\item
	{\it Nevery }: call the function every this many timesteps
\item
	{\it v\_ke }: spring stiffness
\item
	{\it f\_adhmodel }: adhesive force model flag ({\it f\_adhmodel = 1 or 2})

\end{itemize}

\subsubsection*{Required data sections} 
\hyperref[satom]{\tt Atoms} section


\subsubsection*{Example}

\begin{Verbatim}[frame=single]
variable ke equal 5e+10

fix d1 HET epsadh 1 v_ke 1
\end{Verbatim}

\subsubsection*{Description}

The excreted EPS mass from the HET particles can be employed as a parameter of adhesion force models between the particles. The EPS link between the particles are treated as much more stiffer springs, but only employing the attractive forces. Total effective EPS mass $M^{eps}_{ij}$ is calculated between the microbes, and a spring stiffness $k_{e}$ is defined per unit mass. The forces calculated according to the effective spring stiffness ($M^{eps}_{ij} k_{e}$) multiplied by the separation distance between two particles (model 1), or inverse of the separation distance (model 2). 

The EPS-mediated binding forces are calculated as:

\[ \overrightarrow{F}_{eps,ij} = M^{eps}_{ij} k_{e} (d_{ij} - d_{0ij})\cdot\dfrac{\overrightarrow{d}_{ij}}{d_{ij}} \] 
\[ \overrightarrow{F}_{a,i} = \sum_{j=1}^{N} \overrightarrow{F}_{eps,ij} \] 

where $ d_{0ij}$ is the sum of the radii of two interacting particles and $d_{ij}$ is the distance between centres of two particles.

\newpage
\subsection{walladh command}
\label{walladh}
\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
fix ID group-ID walladh v_kanc f_wallstyle lo hi
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it walladh }: style name of this fix command
\item
	{\it v\_kanc }: adhesive strength
\item
	{\it f\_wallstyle }: specify a pair of walls in a dimension ({\it f\_wallstyle 		= xplane or yplane or zplane})
\item
	{\it lo, hi }: position of lower and upper plane

\end{itemize}

\subsubsection*{Required data sections} 
\hyperref[satom]{\tt Atoms} section


\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
variable kanc equal 50

fix xw all walladh v_kanc xplane 0.0 1.0e-04
fix yw all walladh v_kanc yplane 0.0 5.0e-05
\end{Verbatim}

\subsubsection*{Description}

Impose an adhesive force between the wall (the boundary of simulation domain) 
and the microbes attaching to the wall. 
The force is calculated as the product of adhesive strength and overlap distance.

\newpage
\subsection{shear command}
\label{shear}
\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
fix ID group-ID shear Nevery v_viscosity v_shearRate v_height 
f_direction start end
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the fix
\item
	{\it group-ID }: ID of the group of microbes to apply the fix to
\item
	{\it shear }: style name of this fix command
\item
	{\it Nevery }: call the function every this many timesteps
\item
	{\it v\_viscosity}:  dynamic viscosity of fluid
\item
	{\it v\_shear-rate}: rate of change of velocity
\item
	{\it v\_height }: distance to the stationary point from bottom wall 
\item
	{\it f\_direction }: direction of the force ({\it direction = zx or zy})
\item
	{\it start, end }: time range for applying the force

\end{itemize}

\subsubsection*{Required data sections} 
\hyperref[satom]{\tt Atoms} section


\subsubsection*{Examples} 

\begin{Verbatim}[frame=single]
variable viscosity equal 0.5
variable shearRate equal 0.6
variable height equal 5e-5
fix s1 all shear 10 v_viscosity v_shearRate v_height zx 5 500
\end{Verbatim}

\subsubsection*{Description}
Impose an additional shear force each microbe in the group. 
The shear force is calculated according to the drag force created on a sphere in Stokes flow,
and it is given by:

\[ \overrightarrow{F}_{f, i} = 6 \pi \mu r_{i}  \overrightarrow{v_r}\] 

where $\mu$ is dynamic viscosity of fluid, $r_i$ is radius of particle and 
$\overrightarrow{v_r}$ is local fluid velocity relative to the particle.
The parameter $height$ is a user-defined value where the directions of flow above and 
blow the stationary point are in opposition.

\newpage
\subsection{compute ntypes command}
\label{cntypes}   

  \subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
compute ID group-ID ntype
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the computation
\item
	{\it group-ID }: ID of the group of atoms to perform the computation on
\item
	{\it ntype }: style name of this compute command
\end{itemize}

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
compute myNtypes all ntypes
\end{Verbatim}

\subsubsection*{Description}

Define a computation that calculates of total
microbes of each species in the system.
Result values are stored in 
a global vector that can be output via \hyperref[dumpbio]{\tt dump bio}
or \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style} command.

\subsection{compute biomass command}
\label{cbiomass}

\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
compute ID group-ID biomass
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the computation
\item
	{\it group-ID }: ID of the group of atoms to perform the computation on
\item
	{\it biomass }: style name of this compute command
\end{itemize}

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
compute myMass all biomass
\end{Verbatim}

\subsubsection*{Description}

Define a computation that calculates
total biomass of each species in the system.
Result values are stored in 
a global vector that can be output via \hyperref[dumpbio]{\tt dump bio}
or \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style} command.

\newpage
\subsection{compute diameter command}
\label{cdiameter}

\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
compute ID group-ID diameter
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the computation
\item
	{\it group-ID }: ID of the group of atoms to perform the computation on
\item
	{\it diameter }: style name of this compute command
\end{itemize}

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
compute myDia all diameter
\end{Verbatim}

\subsubsection*{Description}

Define a computation that calculates
floc equivalent diameter. 
The specified group must be ``all''.
The equivalent diameter at time t $d_{t,eqv}$ is computed by the formula:

\[ d_{t,eqv} = \sum_{k=1}^{n} \sqrt[3]{\frac{6V_{kt}}{\pi}} \] 

where $V_{kt}$ is volume of each individual spherical particle $k$ at time $t$.
Result value is stored in 
a global scalar that can be output via \hyperref[dumpbio]{\tt dump bio}
or \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style} command.

\newpage
\subsection{compute dimension command}
\label{cdimension}

\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
compute ID group-ID dimension
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the computation
\item
	{\it group-ID }: ID of the group of atoms to perform the computation on
\item
	{\it dimension }: style name of this compute command
\end{itemize}

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
compute myDimen all dimension
\end{Verbatim}

\subsubsection*{Description}
Define a computation that calculates
fractal dimension. 
The specified group must be  ``all''.
The fractal dimension $F_{Dt}$
is computed by the formula:

\[ F_{Dt} = \frac{log(R_a/R_m)}{log(n)} \] 

where $R_a =  \sqrt{\frac{\sum_{k=1}^{n} m_{kt}d^2_{kt}}{\sum_{k=1}^{n} m_{kt}}}$ and 
$R_m = \frac{\sum_{k=1}^{n} r_{kt}}{n}$, $d_{kt}, d_{kt}$ and $m_{k}$ are the particle
diameter, radius and mass respectively. Result value is stored in 
a global scalar that can be output via \hyperref[dumpbio]{\tt dump bio}
or \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style} command.

\newpage
\subsection{compute diversity command}
\label{cdiversity}
\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
compute ID group-ID diversity
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the computation
\item
	{\it group-ID }: ID of the group of atoms to perform the computation on
\item
	{\it diversity }: style name of this compute command
\end{itemize}

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
compute myDiver all diversity
\end{Verbatim}

\subsubsection*{Description}

Define a computation that calculates
diversity index in a system. 
The specified group must be ``all''.
The diversity index $D_t$
at time $t$ is computed by the formula:

\[ D_t = 1 - \frac{\sum n(n-1)}{N(N-1)} \] 

Where $n$ is the total number of organism of a particular specie and $N$
is the total number of microbes of all species.  
Result value is stored in 
a global scalar that can be output via \hyperref[dumpbio]{\tt dump bio}
or \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style} command.


\newpage
\subsection{compute ave\_height command}
\label{caveheight}

\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
compute ID group-ID ave_height nx ny
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the computation
\item
	{\it group-ID }: ID of the group of atoms to perform the computation on
\item
	{\it ave\_height }: style name of this compute command
\item
	{\it nx, ny }: number of grid elements in x, y planes
\end{itemize}

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
compute myHeight all ave_height 50 50
\end{Verbatim}

\subsubsection*{Description}

Define a computation that calculates biofilm average height. 
The specified group must be  ``all''.
The formula is given by:

\[ \overline{h} = \frac{1}{L_xL_y} \int\int h(x,y)dxdy \]

where $h(x,y)$ is biofilm height (measured in z direction) at 
position $(x, y)$ on the substratum.   
Result value is stored in 
a global scalar that can be output via \hyperref[dumpbio]{\tt dump bio}
or \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style} command.

\newpage
\subsection{compute roughness command}
\label{croughness}

\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
compute ID group-ID roughness nx ny
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the computation
\item
	{\it group-ID }: ID of the group of atoms to perform the computation on
\item
	{\it roughness }: style name of this compute command
\item
	{\it nx, ny }: number of grid elements in x, y planes
\end{itemize}

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
compute myRough all roughness 50 50	
\end{Verbatim}

\subsubsection*{Description}

Define a computation that calculates biofilm roughness. 
The specified group must be  ``all''.
The formula is given by:

\[ roughness = \frac{1}{L_xL_y} \int\int (h(x,y) - \overline{h})^2 dxdy \]

where $h(x,y)$ is biofilm height (measured in z direction) at 
position $(x, y)$ on the substratum.  $\overline{h}$ is biofilm average height
Result value is stored in 
a global scalar that can be output via \hyperref[dumpbio]{\tt dump bio}
or \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style} command.


\newpage
\subsection{compute segregation command}
\label{csegregation}

\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
compute mySeg all segregation v_cutoff	
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the computation
\item
	{\it group-ID }: ID of the group of atoms to perform the computation on
\item
	{\it segregation }: style name of this compute command
\item
	{\it v\_cutoff }: cutoff distance for neighbour list calculation (m)
\end{itemize}

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
variable cutoff equal 1e-6

compute mySeg all segregation v_cutoff	
\end{Verbatim}

\subsubsection*{Description}
Define a computation that calculates biofilm segregation index.
The specified group must be  ``all''.
The formula is given by:

\[ \sigma_t = \frac{1}{M} \sum_{i=1}^M (\frac{1}{N} \sum_{j=1}^{N} \rho(c_i, c_j)) \]

\[\text{where} \: \rho(c_i, c_j) = 
 \begin{cases}
  0, c_j \text{ is not the same type as } c_i\\
  1, c_j \text{ is the same type as } c_i
 \end{cases} 
\]

$j$ is neighbour of atom $i$, variable $v\_cutoff$ defines distance to build neighbour list of each atom.
Result value is stored in 
a global scalar that can be output via \hyperref[dumpbio]{\tt dump bio}
or \href{http://lammps.sandia.gov/doc/thermo_style.html}{\tt thermo\_style} command.

\newpage
\subsection{dump bio command}
\label{dumpbio}

\subsubsection*{Syntax}
\begin{Verbatim}[frame=single]
dump ID group-ID bio Nevery file args	
\end{Verbatim}

\begin{itemize}  [nosep]
\item
	{\it ID }: user-assigned name for the dump
\item
	{\it group-ID }: ID of the group of atoms to be dumped
\item
	{\it bio }: style name of this compute command
\item
	{\it Nevery }: dump every this many timesteps
\item
	{\it file }: name of file to write dump info to
\item
	{\it args }:  list of arguments for dump info
\begin{Verbatim}[frame=single]
possible dump info = biomass, ntypes, concentration, 
                     yield, ph, diameter, dimension,
                     diversity, ave_height, roughness, 
                     segregation, DGRAn, DGRCat,
                     ave_concentration
\end{Verbatim}
\begin{Verbatim}[frame=single]
biomass = total biomass of each species
ntypes = total number of microbes of each species 
concentration = nutrient concentration
yield = growth yield 
ph = pH
diameter = floc equivalent diameter
dimension = fractal dimension
diversity = diversity index
ave_height = biofilm average height
roughness = biofilm roughness
segregation = segregation index
DGRAn = Gibbs free energy of anabolism
DGRCat = Gibbs free energy of catabolism
ave_concentration = average nutrient concentration 
\end{Verbatim}

\end{itemize}

\subsubsection*{Examples}

\begin{Verbatim}[frame=single]
compute myMass all biomass
compute myRough all roughness 50 50
dump d0 all bio 1000 biomass concentration roughness
\end{Verbatim}

Dump IBm attributes to one or more data files every $Nevery$ timesteps. 
The related computes of specified attributes must be defined in prior.
The dumped attribute information are related to biofilm, floc and fields. 
To dump atom information (e.g, mass, diameter, position), use 
\href{http://lammps.sandia.gov/doc/dump.html}{\tt dump custom} command.
The {\tt dump bio} command creates a new directory named {\tt /Result} in the current example directory to store output data. 

\newpage
\section{The NUFEB developer team}

\begin{itemize}  
\item
	Bowen Li (\href{mailto:bowen.li2@ncl.ac.uk}{bowen.li2@newcastle.ac.uk}),  School of Computing, Newcastle University, UK
\item
	Jayathilake Pahala Gedara (\href{Jayathilake.Pahala-Gedara@newcastle.ac.uk}{Jayathilake.Pahala-Gedara@newcastle.ac.uk}), School of Engineering, Newcastle University, UK
\item  
    Curtis Madsen (\href{ckmadsen@bu.edu}{ckmadsen@bu.edu}), Boston University, US
\item   	
	Prashant Gupta, Procter \& Gamble, UK
\item
	Rebeca Gonzalez Cabaleiro
\item
	Matthew Wade 
\item 
    Oluwole Oyebamiji (\href{Oyebamiji.Oluwole@newcastle.ac.uk}{Oyebamiji.Oluwole@newcastle.ac.uk}), School of Mathematics, Statistics and Physics, Newcastle University, UK

\end{itemize}

\end{document}
